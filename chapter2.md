# 2章　達人のアプローチ

### よい設計の本質
> Tip 14 より設計は悪い設計より変更しやすい

コードにおけるよい設計とは、変化に対応できることを言う。
そのためETC(Easier To Change)原則という考え方が重要となる。
変化に対応することが重要となるのは、将来的にどのような変更が起きるのかがわからないため、
いつでも記述するコードを交換可能な状態にしておくことが望ましいからである。

- ETC原則に倣った設計の考え方の例
    - 結合の最小化
        - 隔離することで変更しやすくなる
    - 責務の単一化
        - 要求の変更が単一のモジュールに対応づけられる => 他の機能に影響されない
    - 命名規則
        - 変更時に手がかりがつかみやすくなる

### DRY原則
> Tip 15 DRY - Don't Repeat Yourself (繰り返しを避けること)

DRY原則とは「知識」や「意図」の二重化についての原則である。
異なった場所に同じことを表現するという問題を避けるための原則である。

- コードの二重化すべてが知識の二重化というわけではない
    - 例: 年齢とワインの量のデータ量の検証コードにおいて、それぞれの値が0以上になっているかをチェックする関数
        - 0以上であるかを判定する処理という意味では処理の二重化が起きているが、それぞれのデータが0以上であるという知識は別のものとして考えるべきなので、二重化が起きていても問題にはならない。
- ドキュメントの二重化
    - コード変更時にドキュメントも変更する必要が出てくる -> 二重の変更が必要
    - そのため、コードに書かれていることは、コメントに書かないようにすべきである。

- データにおけるDRY原則違反
    - データ構造は知識を表現するため、DRY原則の対象に含まれる。
    - 既に存在している知識で表現できるものは、それらの知識を利用して表現することが望ましい
        - ※パフォーマンス上の観点から意図的にDRY原則を破ることもある。
            - 負荷の大きい繰り返し計算を防ぐために、データをキャッシュするといった時の場合など
```python
@dataclass
class Line:
    start: int
    end: int
    length: int

@dataclass
class Line:
    start: int
    end: int

    @property
    def length(self):
        return (end - start)
```

- 開発者間の二重化
    - 問題
        - 別のプロジェクトで開発しているものと同じものを別のプロジェクトでも開発してしまっている。
    - 解決策
        - 開発者間で頻繁なコミュニケーションが必要
        - プロジェクトのライブラリアンを任命し、再利用できるコードを保管するための場所を作る。
        - 仲間のソースコードやドキュメントを見れる環境を作る。


### 直交性
> Tip 17 関係のないもの同士の影響を排除すること

コンポーネントが互いに独立していると、他の部分を気にせずに変更することが可能である、
またコンポーネントの外部インタフェースを変えない限り、システム全体に影響を与える問題を引き起こすことはなくなる。生産性の向上とリスクの低減というメリットを享受できる。

#### 直交することの利点
- 生産性の向上
    - 変更箇所の局所化による開発とテスト期間の短縮
    - システム間の結合が疎であれば再編成や再作成が簡単になる
    - コンポーネントが疎であれば、機能の組み合わせられるのでより多くの機能が提供できる。

- リスクの低減
    - 問題発生部分を隔離できるため、問題部分だけを切り離して交換することができる
    - テストを実行しやすい
    - 特定のベンダーや製品、プラットフォームと強く結び付くことがなくなる

#### コーディング
- コードの結合度の最小化
    - 他のモジュールの実装をあてにしない
- グローバル変数を避ける
    - 他の箇所でのグローバル変数に対する操作に影響される可能性があるため
- 類似機能を避ける

### 可逆性
> Tip 18 最終決定などというものは存在しない

人間いつも最初からベストな決定をするとは限らないため、DRY原則、分離、外部設定の使用などを行い、後から交換可能な状態を作るようにしておくべきである。

> Tip 19 流行を追い求めないようにする

ベストプラクティスの移り変わりは速く、準備しておくことは難しいので、
流行を追い求めるのではなく、いつでも変更可能な状態することを心がけるべきである。
### 曳光弾
- 曳光弾(えいこうだん)とは
発光体を内蔵した特殊な弾丸。射撃後、飛んでいく間に発光することで軌跡がわかるようになっている。トレーサーとも言う。
射手に弾道を示し、軌跡を知ることで射撃中に方向を修正することができるため、対空射撃、または航空機からの射撃で各種の合図のために使用される。(Wikipediaより)

- 曳光弾型開発
    - 開発時に変動する目標に対するフィードバックを即座に得る必要性を明確にするための呼称(アジャイル開発と同じような感じ?)

開発時には曳光弾を利用し、システムを定義づけられるような重要な要求と疑問のある領域や最大のリスクの存在する箇所を洗い出し、それらの領域を最初に開発できるように優先順位をつけるのがよい。


- 利点
    - 早いうちからユーザにものを提示できる
    - 開発者の活躍できる舞台を生み出せる
    - テスト用のプラットフォームを入手できる
        - 統合テストが容易に実施できる
    - デモ可能なものを手にできる
    - 進捗が明確になる

- 曳光弾 vs. プロトタイピング
    - プロトタイピング: システムの最終形態が持つ特定の側面を探求するためのものである。使い捨てのコード。
    - 曳光弾: アプリ全体の連携、コードを埋め込むためのアーキテクチャ上の骨格を開発者に提示する。システムの骨格となる部分を構成するものである。

    プロトタイピングとは、曳光弾を発射する前に開始する偵察、諜報活動だと考えればいい。

### プロトタイプとポストイット
プロトタイプは、特定の質問に答えることだけを目的としてデザインされるものであるため、
製品となるアプリよりも安価に早く開発可能である。

- プロトタイプで調査できること
    - アーキテクチャ
    - 既存システムに追加する新機能
    - 外部データの構造や内容
    - サードパーティのツールやコンポーネント
    - パフォーマンスの問題
    - ユーザーインタフェースの設計

- プロトタイプを作成する際に無視できること
    - 正確性
        - ダミーデータを使用してもいい
    - 完全性
        - 機能を極端に限定してもいい
    - 堅牢性
        - エラーチェックの不完全性やバグは許容する
    - スタイル
        - コメントやドキュメントは必要ない
    
- アーキテクチャのプロトタイピングの観点
    - 主要コンポーネントの責務が適切に定義されているか?
    - 結合度は最小化されているか?
    - 二重化の原因になりそうなものを識別できているか?
    - インタフェース定義や制約は妥当か?
    - データアクセスの観点

- プロトタイプの誤った使い方
使い捨てを前提にコードを書いていることを関係者に理解してもらっておく必要がある。
そうでないと、プロトタイプを元にその後の開発が進んでしまう可能性がある。
プロトタイプに対する誤解が発生する状況であれば、曳光弾を利用するアプローチに切り替えた方がいい。

### 専用の言語
pass
### 見積り
精度の高い答えを出すための基本的な秘訣は似たような作業を実施した人に聞くことである。

- 見積り作業の手順
    - 問題領域について考える
    - システムのモデル化を行う。
    - モデルをコンポーネント化し、見積りに影響するパラメータを認識する。
    - パラメータに値を入力し、どのパラメータが見積りに大きい影響を与えるのかを特定する。
    - 見積りを計算する。
    - 見積りを記録しておく。自分の見積り能力を見誤らないために、実際との違いの理由を見つけ出す必要がある。

- プロジェクトのスケジュールの見積もる
    - 「楽観的時間」、「最確時間」、「悲観的時間」の3つを定義し、それぞれにおける見積時間を算出しておく。しかし、「方法論」を使用している理由で自らが正確な見積をしていると見誤らせる可能性もある。
    - スケジュールを繰り返し、見積り精度を高めていく。
        - 要求の洗い出し
        - リスク分析
        - 設計と実装、統合を行う
        - ユーザーとともに検証する。
    


