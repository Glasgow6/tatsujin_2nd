# 第5章　柳に雪折れ無し
コードに柳の枝のような柔軟性を持たせることができれば、雪の重みという外界の変化に負けないようになるわけである。
### 分離
> Tip 44 分離されたコードは変更しやすい
- メソッドの呼び出しの連鎖
- 静的なものに潜む危険
- サブクラス化が危険な理由

##### メソッド呼び出しの連鎖
```python
def applyDiscount(customer, order_id, discount):
    totals = customer.orders.find(order_id).getTotals()
    totals.grandTotal = total.grandTotal - discount
    totals.discount = discount
```
メソッドの連鎖を行うと、一つ一つのメソッド実行後のオブジェクトにどのようなメソッドを有しているのかを知っている必要がある。この状態はどこか1つのメソッドに誤りがあった場合にすべてのメソッドや属性に影響を与えてしまう。

> Tip 45 紹介せずに依頼する

この原則は、オブジェクトの内部状態に基づく意思決定をし、その結果で該当オブジェクトを更新してはならないというもの。上記のコードでは、applyDiscount関数内でtotalという総額を管理するオブジェクトの値を書き換えているが、これはカプセル化を破壊しているため、適切な実装ではない。
```python
def applyDiscount(customer, order_id, discount):
    customer.orders.find(order_id).getTotals().applyDiscount(discount)
```
上記のように実装し直すことで、総額オブジェクト自身に総額の値下げを依頼し、実行させることができ、カプセル化を保つことができる。

### 静的なものに潜む危険
影響を受ける箇所の特定が難しくなる。

### サブクラス化が危険な理由
P. 202で出るため飛ばす

### 実世界を扱う
- 有限状態機械(FSM)
    - イベントに対してどのように振る舞うのかを規定しただけのもの
- Observerパターン
- Publish/Subscribe プロトコル
    - チャンネルを介して、接続される。チャンネルはコード本体から切り離されている。
    - Publish: チャンネルへの書き込み
    - Subscribe: 興味のあるチャンネルを登録しておく。
    - 共有インタフェースを通じた抽象化により結合度を引き下げている。
    - メッセージパッシングシステム
- リアクティブプログラミングとストリーム、イベント
    - 時間とともに変化していくデータ（ストリーム）同士の関連性と操作を、宣言的に記述するプログラミングの手法
    - Vue, React


### 変換のプログラミング
> Tip 50 状態をため込まず、引き渡すようにする

データが変換していく過程で、関数の出力値が次の関数の入力値になるというのが連鎖的に発生する。
各関数の引数が他の関数の出力にマッチするのであれば、どこでも使えるようになり、結合を低減することができる。
実際は、ある程度の結合は存在するが、型チェックによるサポートで関係のない関数同士の接続はコンパイル時に警告を得ることができる。

- エラーの取り扱い方
    - 変換の間では生の値をやりとりせず、ある種のデータ構造を定義したものでやりとりを行うことでデータのやり取りの前に、所望のデータ構造になっているかのチェックを行い、その段階でエラーを捕捉する。
### インヘリタンス（相続）税
##### コード共有のために軽傷を使う場合の問題点
- 親クラスの実装の変更によって、子クラスにも影響が出る。結合している。

##### 型の構築のために軽傷を使う場合の問題点
- クラス間の微妙な違いを表現するために、複雑な階層を有するクラス階層図になってしまう。
- 多重継承が発生したときに、正確にモデル化することが難しくなる。

#### 優れた代替が存在する
> Tip 52　ポリモーフィズムの表現にはインターフェースを愛用すること
- インタフェースとプロトコル
    - あるクラスが有する振る舞いを定義できる。
    - 継承を使わずにポリモーフィズムを実現できる。

> Tip 53　サービスに委譲すること：has-aはis-aに勝る
- 委譲
    - 継承では子クラスでは利用しない親クラスのメソッドが呼び出せる状態になっているが、これはインタフェースの統制を失った状態と言える。
    - 委譲では、実行したい処理を持つオブジェクトを渡してメソッドを実行する。

> Tip 54　機能の共有にはmixinを使用する
- mixin
検討すべきシチュエーションは、継承を使用することなく、クラスやオブジェクトに新しい機能を追加したいという状況。
>「継承」が「基底クラスの機能を受け継ぎながら、必要に応じて、その振る舞いを変更したり、新たな機能を追加したりすることでより特殊な（具体的な）クラスへと仕立てる」ことに対して、「ミックスイン」は「既にある機能を、親子関係にない複数のクラスで共通に利用する」ものと考えられる。
(引用元) https://atmarkit.itmedia.co.jp/ait/articles/1909/03/news021.html

### 設定
> Tip 55　外部設定を用いてアプリをパラメータに対応させる
- 外部サービスの認証情報（データベース、API）
- ログ出力レベルやログの出力先
- アプリが使用するポート番号やIPアドレス、マシン名、クラスター名
- 環境依存の検証パラメーター
など変更する必要があるとわかっているものは、コードの外で設定データとして扱う。
